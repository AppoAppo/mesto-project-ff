(()=>{"use strict";var e,t="wff-cohort-31",n="057f6eed-c7f1-469e-924e-bcd46b6ce088",o="https://nomoreparties.co/v1",r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},a=document.querySelector("#card-template").content.querySelector(".places__item"),i="popup_is-opened",c=function(e){e.classList.add(i),document.addEventListener("keydown",l)},u=function(e){e.classList.remove(i),document.removeEventListener("keydown",l)},l=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");u(t)}},d=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},s=function(e,t){var n=e.querySelector(t.submitButtonSelector);n.classList.add(t.inactiveButtonClass),n.disabled=!0,Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){m(e,n,t)}))},f=function(e,t,n){return e.querySelector(n.errorElementMask.prefix+t.name+n.errorElementMask.suffix)},p=function(e,t,n){var o=f(e,t,n);t.classList.add(n.inputErrorClass),o.textContent=t.validationMessage,o.classList.add(n.errorClass)},m=function(e,t,n){var o=f(e,t,n);t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},v=document.querySelector(".places__list"),_={editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image"),addNewCard:document.querySelector(".popup_type_new-card"),changeAvatar:document.querySelector(".popup_type_change-avatar")},h={editProfile:document.querySelector(".profile__edit-button"),addNewCard:document.querySelector(".profile__add-button")},y={editProfile:document.forms["edit-profile"],addNewCard:document.forms["new-place"],changeAvatar:document.forms["change-avatar"]},b={name:document.querySelector(".profile__title"),job:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image")},g={url:_.image.querySelector(".popup__image"),caption:_.image.querySelector(".popup__caption")},C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",errorElementMask:{prefix:".popup__input_",suffix:"-error"}},S=function(e,t){return e.textContent=t},k=function(e){var t=e.submitter.textContent;return e.submitter.textContent="Сохранение...",t},E={delete:function(e,a){(function(e){return fetch("".concat(o,"/").concat(t,"/cards/").concat(e),{method:"DELETE",headers:{authorization:n,"Content-Type":"application/json"}}).then(r)})(a).then((function(){return e.remove()})).catch((function(e){console.log(e)}))},like:function(e,a){var i="card__like-button_is-active",c=e.querySelector(".card__like-count");(function(e,a){var i=a?"DELETE":"PUT";return fetch("".concat(o,"/").concat(t,"/cards/likes/").concat(e),{method:i,headers:{authorization:n}}).then(r)})(a,e.querySelector(".card__like-button").classList.contains(i)).then((function(t){e.querySelector(".card__like-button").classList.toggle(i),c.textContent=t.likes.length})).catch((function(e){console.log(e)}))},imgPopup:function(e){g.url.src=e.link,g.url.alt=e.name,g.caption.textContent=e.name,c(_.image)}},q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"append",n=function(e,t){var n=a.cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),i=n.querySelector(".card__delete-button"),c=n.querySelector(".card__like-button"),u=n.querySelector(".card__like-count");return o.src=e.link,o.alt=e.name,r.textContent=e.name,e.deleteAvailable?i.addEventListener("click",(function(){return t.delete(n,e._id)})):i.style.visibility="hidden",c.addEventListener("click",(function(){return t.like(n,e._id)})),e.liked&&c.classList.add("card__like-button_is-active"),o.addEventListener("click",(function(){return t.imgPopup(e)})),u.textContent=e.likes.length,n}(e,E);v[t](n)};document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){u(e.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){return function(e,t){e.target===t&&u(t)}(t,e)}))})),y.addNewCard.addEventListener("submit",(function(e){e.preventDefault();var a,i=k(e);(a={name:y.addNewCard["place-name"].value,link:y.addNewCard.link.value},fetch("".concat(o,"/").concat(t,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:a.name,link:a.link})}).then(r)).then((function(t){t.deleteAvailable=!0,q(t,"prepend"),e.target.reset(),s(y.addNewCard,C),u(_.addNewCard)})).catch((function(e){console.log(e)})).finally((function(){return S(e.submitter,i)}))})),y.editProfile.addEventListener("submit",(function(e){e.preventDefault();var a,i,c=k(e);(a=y.editProfile.name.value,i=y.editProfile.description.value,fetch("".concat(o,"/").concat(t,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:i})}).then(r)).then((function(e){b.name.textContent=e.name,b.job.textContent=e.about,u(_.editProfile)})).catch((function(e){console.log(e)})).finally((function(){return S(e.submitter,c)}))})),y.changeAvatar.addEventListener("submit",(function(e){e.preventDefault();var a,i=k(e);(a=y.changeAvatar["link-avatar"].value,fetch("".concat(o,"/").concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({avatar:a})}).then(r)).then((function(t){b.avatar.style.backgroundImage="url('".concat(y.changeAvatar["link-avatar"].value,"')"),e.target.reset(),s(y.changeAvatar,C),u(_.changeAvatar)})).catch((function(e){console.log(e)})).finally((function(){return S(e.submitter,i)}))})),h.addNewCard.addEventListener("click",(function(e){c(_.addNewCard)})),h.editProfile.addEventListener("click",(function(e){y.editProfile.name.value=b.name.textContent,y.editProfile.description.value=b.job.textContent,s(y.editProfile,C),c(_.editProfile)})),b.avatar.addEventListener("click",(function(e){s(y.changeAvatar,C),c(_.changeAvatar)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,n):p(e,t,n)})(e,r,t),d(n,o,t)}))})),d(n,o,t)}(t,e)}))}(C),e=[fetch("".concat(o,"/").concat(t,"/users/me"),{headers:{authorization:n}}).then(r),fetch("".concat(o,"/").concat(t,"/cards"),{headers:{authorization:n}}).then(r)],Promise.all(e).then((function(e){var t=e[0],n=e[1];b.name.textContent=t.name,b.job.textContent=t.about,b.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),n.forEach((function(e){e.owner._id===t._id?e.deleteAvailable=!0:e.deleteAvailable=!1,e.liked=e.likes.some((function(e){return e._id===t._id})),q(e)}))})).catch((function(e){console.log(e)}))})();