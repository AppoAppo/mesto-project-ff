(()=>{"use strict";var e,t="wff-cohort-31",n="057f6eed-c7f1-469e-924e-bcd46b6ce088",o="https://nomoreparties.co/v1",r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},a=document.querySelector("#card-template").content.querySelector(".places__item"),i="popup_is-opened",c=function(e){e.classList.add(i),document.addEventListener("keydown",l)},u=function(e){e.classList.remove(i),document.removeEventListener("keydown",l)},l=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");u(t)}},d=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))},s=function(e,t){var n=e.querySelector(t.submitButtonSelector);n.classList.add("popup__button_disabled"),n.disabled=!0,Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(t){f(e,t)}))},p=function(e,t,n){var o=e.querySelector(".popup__input_".concat(t.name,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error_visible")},f=function(e,t){var n=e.querySelector(".popup__input_".concat(t.name,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error_visible-error_active"),n.textContent=""},_=document.querySelector(".places__list"),m={editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image"),addNewCard:document.querySelector(".popup_type_new-card"),changeAvatar:document.querySelector(".popup_type_change-avatar")},v={editProfile:document.querySelector(".profile__edit-button"),addNewCard:document.querySelector(".profile__add-button")},h={editProfile:document.forms["edit-profile"],addNewCard:document.forms["new-place"],changeAvatar:document.forms["change-avatar"]},y={name:document.querySelector(".profile__title"),job:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image")},b={url:m.image.querySelector(".popup__image"),caption:m.image.querySelector(".popup__caption")},g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=function(e,t){return e.textContent=t},k=function(e){var t=e.target.querySelector(".popup__button"),n=t.textContent;return t.textContent="Сохранение...",{button:t,buttonOriginalText:n}},C={delete:function(e,a){(function(e){return fetch("".concat(o,"/").concat(t,"/cards/").concat(e),{method:"DELETE",headers:{authorization:n,"Content-Type":"application/json"}}).then((function(e){r(e)}))})(a).then((function(){return e.remove()})).catch((function(e){console.log(e)}))},like:function(e,a){var i="card__like-button_is-active",c=e.querySelector(".card__like-count");(function(e,a){var i=a?"DELETE":"PUT";return fetch("".concat(o,"/").concat(t,"/cards/likes/").concat(e),{method:i,headers:{authorization:n}}).then((function(e){r(e)}))})(a,e.querySelector(".card__like-button").classList.contains(i)).then((function(t){e.querySelector(".card__like-button").classList.toggle(i),c.textContent=t.likes.length})).catch((function(e){console.log(e)}))},imgPopup:function(e){c(m.image),b.url.src=e.link,b.url.alt=e.name,b.caption.textContent=e.name}},q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"append",n=function(e,t){var n=a.cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),i=n.querySelector(".card__delete-button"),c=n.querySelector(".card__like-button"),u=n.querySelector(".card__like-count");return o.src=e.link,o.alt=e.name,r.textContent=e.name,e.deleteAvailable?i.addEventListener("click",(function(){return t.delete(n,e._id)})):i.style.visibility="hidden",c.addEventListener("click",(function(){return t.like(n,e._id)})),e.liked&&c.classList.add("card__like-button_is-active"),o.addEventListener("click",(function(){return t.imgPopup(e)})),u.textContent=e.likes.length,n}(e,C);_[t](n)};document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){u(e.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){return function(e,t){e.target===t&&u(t)}(t,e)}))})),h.addNewCard.addEventListener("submit",(function(e){e.preventDefault();var a,i=k(e),c=i.button,l=i.buttonOriginalText;(a={name:h.addNewCard["place-name"].value,link:h.addNewCard.link.value},fetch("".concat(o,"/").concat(t,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:a.name,link:a.link})}).then((function(e){r(e)}))).then((function(t){t.deleteAvailable=!0,q(t,"prepend"),e.target.reset(),s(h.addNewCard,g),u(m.addNewCard)})).catch((function(e){console.log(e)})).finally((function(){return S(c,l)}))})),h.editProfile.addEventListener("submit",(function(e){e.preventDefault();var a,i,c=k(e),l=c.button,d=c.buttonOriginalText;(a=h.editProfile.name.value,i=h.editProfile.description.value,fetch("".concat(o,"/").concat(t,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:i})}).then((function(e){r(e)}))).then((function(e){y.name.textContent=e.name,y.job.textContent=e.about,u(m.editProfile)})).catch((function(e){console.log(e)})).finally((function(){return S(l,d)}))})),h.changeAvatar.addEventListener("submit",(function(e){e.preventDefault();var a,i=k(e),c=i.button,l=i.buttonOriginalText;(a=h.changeAvatar["link-avatar"].value,fetch("".concat(o,"/").concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({avatar:a})}).then((function(e){r(e)}))).then((function(t){y.avatar.style.backgroundImage="url('".concat(h.changeAvatar["link-avatar"].value,"')"),e.target.reset(),s(h.changeAvatar,g),u(m.changeAvatar)})).catch((function(e){console.log(e)})).finally((function(){return S(c,l)}))})),v.addNewCard.addEventListener("click",(function(e){c(m.addNewCard)})),v.editProfile.addEventListener("click",(function(e){h.editProfile.name.value=y.name.textContent,h.editProfile.description.value=y.job.textContent,s(h.editProfile,g),c(m.editProfile)})),y.avatar.addEventListener("click",(function(e){s(h.changeAvatar,g),c(m.changeAvatar)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n){var o=Array.from(e.querySelectorAll(t)),r=e.querySelector(n);o.forEach((function(t){t.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t):p(e,t,t.validationMessage)})(e,t),d(o,r)}))})),d(o,r)}(t,e.inputSelector,e.submitButtonSelector)}))}(g),e=[fetch("".concat(o,"/").concat(t,"/users/me"),{headers:{authorization:n}}).then((function(e){r(e)})),fetch("".concat(o,"/").concat(t,"/cards"),{headers:{authorization:n}}).then((function(e){r(e)}))],Promise.all(e).then((function(e){var t=e[0],n=e[1],o=t._id;y.name.textContent=t.name,y.job.textContent=t.about,y.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),n.forEach((function(e){e.owner._id===o?e.deleteAvailable=!0:e.deleteAvailable=!1,e.liked=e.likes.some((function(e){return e._id===o})),q(e)}))}))})();